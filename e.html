<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Winston Churchill High School Athletics Admin Dashboard</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-analytics.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Chart.js for graphs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/material-ui/4.12.4/index.js" integrity="sha512-wEnX3bNd/CdyrOFR0KIGlHihK/w9x3/It8Vc18aymEF/F/f1q0Mq8T+GSxF1wYUACLEGECapuIYQdQlKY1LBJw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        body {
            background-color: #f8f9fa;
            transition: background-color 0.5s;
        }
        .admin-tab {
            display: none;
        }
        .container {
            margin-top: 20px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.5s;
        }
        h1 {
            color: #007bff;
            text-align: center;
        }
        .score {
            font-size: 2em;
            margin: 20px 0;
        }
        .button {
            margin: 5px;
        }
        .enter-score-popup, .login-popup, .create-log-popup {
            display: none;
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            width: 300px;
        }
        /* AI Tab Container */
#ai {
    padding: 20px;
    background-color: #f9f9f9;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    max-width: 600px;
    margin: auto;
}

/* Title */
.ai-title {
    font-size: 1.8em;
    font-weight: bold;
    color: #007bff;
    text-align: center;
    margin-bottom: 20px;
}

/* Description */
.ai-description {
    font-size: 1.2em;
    color: #555;
    text-align: center;
    margin-bottom: 20px;
}

/* Input Group */
.ai-input-group {
    display: flex;
    gap: 10px;
    align-items: center;
    justify-content: center;
}

/* Input Field */
.ai-input {
    flex: 1;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    transition: border-color 0.3s ease;
}

.ai-input:focus {
    border-color: #007bff;
    outline: none;
    box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
}

/* Submit Button */
.ai-submit {
    padding: 10px 20px;
    border-radius: 5px;
    font-size: 1em;
    transition: background-color 0.3s ease, transform 0.2s ease;
}

.ai-submit:hover {
    background-color: #0056b3;
    transform: scale(1.05);
}

/* Response Section */
.ai-response {
    margin-top: 20px;
    padding: 15px;
    background-color: #e9ecef;
    border-radius: 5px;
    border: 1px solid #ccc;
    font-size: 1.1em;
    color: #333;
    min-height: 100px;
    text-align: center;
}

.ai-placeholder {
    color: #999;
}

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 1);
            z-index: 999;
        }
        .connection-status {
            margin-top: 20px;
            font-weight: bold;
            text-align: center;
            color: white;
        }
        .stats {
            margin-top: 20px;
            font-size: 1.2em;
            text-align: center;
        }
        .logins {
            margin-top: 20px;
            font-size: 1.2em;
            text-align: bottom;
        }
        .title-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-top: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .sidebar {
    height: 100vh; /* Full viewport height */
    overflow-y: auto; /* Enable vertical scrolling */
    overflow-x: hidden; /* Prevent horizontal scrolling */
    position: fixed;
    top: 0;
    left: 0;
    width: 260px;
    background: linear-gradient(145deg, #343a40, #212529); /* Gradient background */
    padding-top: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
    color: white;
    font-family: 'Roboto', sans-serif;
    z-index: 1000;
}

/* Optional: Customize scrollbar appearance */
.sidebar::-webkit-scrollbar {
    width: 8px; /* Width of the scrollbar */
}

.sidebar::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.5); /* Color of the scrollbar thumb */
    border-radius: 4px; /* Round edges of the scrollbar */
}

.sidebar::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.8); /* Change color on hover */
}


.sidebar h2 {
    color: #ffc107; /* Gold color for the title */
    margin-bottom: 20px;
    font-size: 1.4em;
    text-align: center;
}

.sidebar a {
    padding: 10px 15px;
    margin: 5px 0;
    text-decoration: none;
    color: white;
    border-radius: 5px;
    display: block;
    text-align: center;
    transition: background-color 0.3s;
}


.sidebar a:hover {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    transform: scale(1.05);
}

.sidebar a.active {
    background: #007bff; /* Highlight active link */
    color: white;
}

.sidebar img.logo {
    width: 150px;
    border-radius: 50%;
    margin-bottom: 20px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.sidebar #connection-label {
    font-size: 0.9em;
    margin-top: 20px;
}

.sidebar #current-time {
    font-size: 0.9em;
    margin-top: 10px;
}

        .content {
            margin-left: 260px;
            padding: 20px;
        }
       
        .navbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            padding: 10px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .dark-mode {
            background-color: #343a40;
            color: white;
        }
        .dark-mode .container {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .dark-mode .sidebar {
            background-color: rgba(52, 58, 64, 0.9);
        }
        .quarter-selector {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .toggle-container {
            display: flex;
            align-items: center;
            margin-top: 20px;
        }
        .toggle-label {
            margin-right: 10px;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 34px;
            height: 20px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 20px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            border-radius: 50%;
            transition: .4s;
        }
        .message-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 300px;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    background-color: white;
    z-index: 1000;
    text-align: center;
}

.message-popup textarea {
    width: 100%;
    height: 100px;
    margin-bottom: 10px;
}

.message-popup button {
    margin: 5px;
}

        input:checked + .slider {
            background-color: #007bff;
        }
        input:checked + .slider:before {
            transform: translateX(14px);
        }
        .log-card {
            border: 1px solid #007bff;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        .search-bar {
            margin-bottom: 20px;
        }
        .logo {
            width: 100%;
            max-width: 200px;
            margin: 20px auto;
            display: block;
        }
        .info-section {
            margin-top: 20px;
            text-align: center;
        }
        .loading-spinner {
            display: none;
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
        }
        .fade {
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .fade.show {
            opacity: 1;
        }
        /* Mobile styles */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            .content {
                margin-left: 0;
                padding: 10px;
            }
            .score {
                font-size: 1.5em;
            }
        }
        /* Fullscreen styles for projector mode */
        .projector-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
            font-size: 5em;
        }
        /* Tooltip styles */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: black;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 0;
            position: absolute;
            z-index: 1;
            bottom: 125%; /* Position above the tooltip */
            left: 50%;
            margin-left: -60px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        #message-container div {
    padding: 5px;
    margin-bottom: 5px;
    border-bottom: 1px solid #ccc;
}

#sidebar-search {
    margin: 10px 0;
    padding: 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
    width: 90%;
}

.sidebar.collapsed {
    width: 80px;
    transition: width 0.3s;
}

.sidebar.collapsed a {
    font-size: 0;
    padding: 10px;
}

.sidebar.collapsed img.logo {
    width: 50px;
}



    </style>
</head>
<body>

    <div class="overlay" id="login-overlay"></div>
    <div class="login-popup" id="login-popup">
        <h2>Login</h2>
        <input type="email" id="login-email" class="form-control" placeholder="Email" required />
        <input type="password" id="login-password" class="form-control" placeholder="Password" required />
        <button class="btn btn-success" id="login-button">Login</button>
        <button class="btn btn-secondary" id="c" onclick="closeLoginPopup()">Cancel</button>
        <div id="login-error" style="color: red; display: none;"></div>
    </div>

    <div class="sidebar">
        <input type="text" id="sidebar-search" placeholder="Search..." class="form-control">
        <img src="https://s3-us-west-2.amazonaws.com/sportshub2-uploads-prod/files/sites/230/2017/07/13191049/17688.png" alt="Winston Churchill High School Athletics" class="logo">
        <h2>Admin Dashboard</h2>
        <div id="connection-label">Checking connection...</div>
        <div id="current-time">Current Time: --:--</div>
        <div id="logins" class="text-white text-bottom" style="margin-top: 10px;">Loading User</div>
        <a href="#score" onclick="showTab('score')">Score Management</a>
        <a href="#title" onclick="showTab('title')">Game Title</a>
        <a href="#stats" onclick="showTab('stats')">Statistics</a>
        <a href="#logs" onclick="showTab('logs')">Logs</a>
        <a href="#ai" onclick="showTab('ai')">AI Assistant</a>
        <a href="#info" onclick="showTab('info')">Info</a>
        <a href="#settings" onclick="showTab('settings')">Settings</a>
        <a href="#admin" onclick="showTab('admin')">Admin</a>
        <a href="#inbox" onclick="showTab('inbox')">Inbox</a>
    </div>
    

    <div class="content">
        <h1>Winston Churchill High School Athletics Admin Dashboard</h1>
        

        <div id="inbox" class="tab-content admin-tab fade" style="display:none;">
            <h2>Inbox</h2>
            <div id="message-container" style="max-height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; border-radius: 5px; margin-bottom: 20px;">
                <!-- Messages will appear here -->
            </div>
        </div>

        <div id="admin" class="tab-content admin-tab fade">
    <h2>User Management</h2>
    <button class="btn btn-primary" onclick="openCreateUserPopup()">Create User</button>
    <button class="btn btn-primary" onclick="openMessagePopup()">Send Message</button>
    <div id="user-list"></div>
</div>

<!-- Message Popup -->
<div id="message-popup" class="message-popup" style="display:none;">
    <h3>Send a Message</h3>
    <textarea id="popup-message-input" class="form-control" placeholder="Type your message here..."></textarea>
    <button class="btn btn-success mt-2" onclick="sendMessageFromPopup()">Send</button>
    <button class="btn btn-secondary mt-2" onclick="closeMessagePopup()">Cancel</button>
</div>


        <div id="score" class="tab-content fade show">
            <h2>Score Management</h2>
            <div class="row">
                <div class="col text-center">
                    <h3>Home Team</h3>
                    <p class="score" id="home-score">0</p>
                    <button class="btn btn-success" onclick="updateScore('home', 1)">+1</button>
                    <button class="btn btn-success" onclick="updateScore('home', 2)">+2</button>
                    <button class="btn btn-success" onclick="updateScore('home', 3)">+3</button>
                    <button class="btn btn-danger" onclick="updateScore('home', -1)">-1</button>
                    <button class="btn btn-danger" onclick="updateScore('home', -2)">-2</button>
                    <button class="btn btn-danger" onclick="updateScore('home', -3)">-3</button>
                    <button class="btn btn-primary" onclick="">Enter Score</button>
                </div>
                <div class="col text-center">
                    <h3>Away Team</h3>
                    <p class="score" id="away-score">0</p>
                    <button class="btn btn-success" onclick="updateScore('away', 1)">+1</button>
                    <button class="btn btn-success" onclick="updateScore('away', 2)">+2</button>
                    <button class="btn btn-success" onclick="updateScore('away', 3)">+3</button>
                    <button class="btn btn-danger" onclick="updateScore('away', -1)">-1</button>
                    <button class="btn btn-danger" onclick="updateScore('away', -2)">-2</button>
                    <button class="btn btn-danger" onclick="updateScore('away', -3)">-3</button>
                    <button class="btn btn-primary" onclick="">Enter Score</button>
                </div>
            </div>
            <div class="form-group text-center">
                <label for="quarter">Quarter:</label>
                <select id="quarter" class="quarter-selector" onchange="updateQuarter()">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                </select>
            </div>
            <button class="btn btn-info" onclick="logScore()">Log Score</button>
            <button class="btn btn-danger" onclick="clearScores()">Clear Scores</button>
            <button class="btn btn-warning" onclick="endGame()">End Game</button>
            <button class="btn btn-secondary" onclick="toggleProjectorMode()">Projector Mode</button>
        </div>

        <div id="title" class="tab-content fade" style="display:none;">
            <h2>Game Title</h2>
            <div class="form-group">
                <label for="game-title">Game Title:</label>
                <input type="text" id="game-title" class="form-control title-input" placeholder="Enter game title" oninput="updateGameTitle()">
            </div>
            <div class="form-group">
                <label for="away-team-name">Away Team Name:</label>
                <input type="text" id="away-team-name" class="form-control title-input" placeholder="Enter Away Team Name" oninput="updateAwayTeamName()">
            </div>
        </div>

        <div id="stats" class="tab-content fade" style="display:none;">
            <h2>Statistics</h2>
            <canvas id="scoring-trends" width="400" height="200"></canvas> <!-- Graph for scoring trends -->
            <p id="active-visitors">Active Visitors: 0</p>
        </div>

        <div id="logs" class="tab-content fade" style="display:none;">
            <h2>Game Logs</h2>
            <input type="text" id="search-bar" class="form-control search-bar" placeholder="Search logs..." oninput="filterLogs()">
            <input type="date" id="date-filter" class="form-control" onchange="filterLogsByDate()">
            <input type="date" id="end-date-filter" class="form-control" placeholder="End Date" onchange="filterLogsByDateRange()">
            <div id="game-logs-container"></div>
            <button class="btn btn-primary" onclick="exportLogsToPDF()">Export to PDF</button>
            <button class="btn btn-secondary" onclick="exportLogsToCSV()">Export to CSV</button>
            <button class="btn btn-secondary" onclick="exportLogsToExcel()">Export to Excel</button>
            <button class="btn btn-danger" onclick="bulkDeleteLogs()">Delete Selected Logs</button>
            <div id="pagination" class="mt-3"></div> <!-- Pagination controls -->
            <button class="btn btn-success" onclick="openCreateLogPopup()">Create Log</button>
        </div>

        <div id="ai" class="tab-content fade" style="display:none;">
            <h2 class="ai-title">AI Assistant</h2>
            <div class="ai-container">
                <p class="ai-description">Ask your question below, and the AI assistant will provide guidance.</p>
                <div class="ai-input-group">
                    <input type="text" id="ai-question" class="form-control ai-input" placeholder="Enter your question here..." />
                    <button class="btn btn-primary ai-submit" onclick="askAI()">Ask AI</button>
                </div>
                <div id="ai-response" class="ai-response">
                    <p class="ai-placeholder">Your response will appear here...</p>
                </div>
            </div>
        </div>

        <div id="info" class="tab-content fade" style="display:none;">
            <h2>Info</h2>
            <div class="info-section">
                <p>Copyright © WCHS Athletics 2025</p>
                <p>Powered by <img src="https://assets.vnnsports.net/2021/01/14133922/vnn-logo-blackwhiteoutline.png" alt="VNN API" style="height: 30px;"></p>
            </div>
        </div>

        <div id="settings" class="tab-content fade" style="display:none;">
            <h2>Settings</h2>
            <div class="toggle-container">
                <span class="toggle-label">Dark Mode:</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="dark-mode-toggle">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="form-group">
                <label for="theme-select">Select Theme:</label>
                <select id="theme-select" class="form-control" onchange="changeTheme()">
                    <option value="default">Default</option>
                    <option value="blue">Blue</option>
                    <option value="green">Green</option>
                    <option value="red">Red</option>
                </select>
            </div>
        </div>

        <div class="overlay" id="create-user-overlay"></div>
        <div class="create-user-popup" id="create-user-popup" style="display: none;">
            <h2>Create User</h2>
            <input type="email" id="new-user-email" class="form-control" placeholder="Email" required />
            <input type="password" id="new-user-password" class="form-control" placeholder="Password" required />
            <button class="btn btn-success" onclick="createUser()">Create User</button>
            <button class="btn btn-secondary" onclick="closeCreateUserPopup()">Cancel</button>
        </div>
    </div>

    <div class="overlay" id="overlay"></div>
    <div class="login-popup" id="create-log-popup">
        <h2>Create Log</h2>
        <div class="form-group">
            <label for="log-game">Game:</label>
            <input type="text" id="log-game" class="form-control" placeholder="Enter game name">
        </div>
        <div class="form-group">
            <label for="log-home-score">Home Score:</label>
            <input type="number" id="log-home-score" class="form-control" placeholder="Enter home score">
        </div>
        <div class="form-group">
            <label for="log-away-score">Away Score:</label>
            <input type="number" id="log-away-score" class="form-control" placeholder="Enter away score">
        </div>
        <button class="btn btn-success" onclick="createLog()">Create Log</button>
        <button class="btn btn-secondary" onclick="closeCreateLogPopup()">Cancel</button>
    </div>

    <div class="loading-spinner" id="loading-spinner">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>

    <div id="projector-mode" class="projector-mode">
        <div>
            <span id="projector-score">Score: 0 - 0</span>
            <br>
            <span id="projector-quarter">Quarter: 1</span>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBLknke4IwRj2g0zqsp6CDZxDDxePY3qI8",
            authDomain: "test-71ecd.firebaseapp.com",
            databaseURL: "https://test-71ecd-default-rtdb.firebaseio.com",
            projectId: "test-71ecd",
            storageBucket: "test-71ecd.firebasestorage.app",
            messagingSenderId: "426214403781",
            appId: "1:426214403781:web:4af409ec8186bd821d4aac",
            measurementId: "G-C7VBNTXM8R"
        };

        function sendMessage() {
    const message = document.getElementById("message-input").value.trim();
    if (message === "") {
        alert("Message cannot be empty.");
        return;
    }

    const messageData = {
        sender: "System", // Default sender
        content: message,
        timestamp: new Date().toISOString()
    };

    $.ajax({
        url: `https://test-71ecd-default-rtdb.firebaseio.com/messages.json`, // Firebase REST API endpoint
        type: "POST",
        data: JSON.stringify(messageData),
        contentType: "application/json",
        success: function () {
            document.getElementById("message-input").value = ""; // Clear input field
            loadMessages(); // Refresh messages
        },
        error: function (err) {
            console.error("Error sending message:", err);
        }
    });
}

document.querySelector('.sidebar').addEventListener('dblclick', function() {
    this.classList.toggle('collapsed');
});


function loadMessages() {
    $.ajax({
        url: `https://test-71ecd-default-rtdb.firebaseio.com/messages.json`, // Firebase REST API endpoint
        type: "GET",
        success: function (data) {
            const messageContainer = document.getElementById("message-container");
            messageContainer.innerHTML = ""; // Clear previous messages

            if (data) {
                // Sort messages by timestamp
                const messages = Object.values(data).sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));

                // Append each message to the container
                messages.forEach((msg) => {
                    const messageDiv = document.createElement("div");
                    messageDiv.textContent = `[${new Date(msg.timestamp).toLocaleTimeString()}] ${msg.sender}: ${msg.content}`;
                    messageContainer.appendChild(messageDiv);
                });
            }
        },
        error: function (err) {
            console.error("Error loading messages:", err);
        }
    });
}


        function openCreateUserPopup() {
            //    document.getElementById('create-user-overlay').style.display = 'block';
                document.getElementById('create-user-popup').style.display = 'block';
            }

            // Function to close the create user popup
            function closeCreateUserPopup() {
                document.getElementById('create-user-overlay').style.display = 'none';
                document.getElementById('create-user-popup').style.display = 'none';
                document.getElementById('new-user-email').value = ''; // Clear input
                document.getElementById('new-user-password').value = ''; // Clear password input
            }

            function openMessagePopup() {
    document.getElementById("message-popup").style.display = "block";
}

function closeMessagePopup() {
    document.getElementById("message-popup").style.display = "none";
    document.getElementById("popup-message-input").value = ""; // Clear input field
}


function sendMessageFromPopup() {
    const message = document.getElementById("popup-message-input").value.trim();
    if (message === "") {
        alert("Message cannot be empty.");
        return;
    }

    const firebaseURL = "https://test-71ecd-default-rtdb.firebaseio.com"; // Replace with your database URL
    const messageData = {
        sender: "System", // Default sender
        content: message,
        timestamp: new Date().toISOString()
    };

    $.ajax({
        url: `${firebaseURL}/messages.json`, // Firebase REST API endpoint
        type: "POST",
        data: JSON.stringify(messageData),
        contentType: "application/json",
        success: function () {
            alert("Message sent successfully!");
            closeMessagePopup(); // Close the popup after sending
        },
        error: function (err) {
            console.error("Error sending message:", err);
            alert("Failed to send message. Please try again.");
        }
    });
}

document.getElementById('sidebar-search').addEventListener('input', function() {
    const query = this.value.toLowerCase();
    const links = document.querySelectorAll('.sidebar a');
    links.forEach(link => {
        link.style.display = link.textContent.toLowerCase().includes(query) ? 'block' : 'none';
    });
});



        // Function to open the login popup
        function openLoginPopup() {
            document.getElementById('login-overlay').style.display = 'block';
            document.getElementById('login-popup').style.display = 'block';
            document.getElementById('c').style.display = 'none';
        }

        // Function to close the login popup
        function closeLoginPopup() {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('login-popup').style.display = 'none';
            document.getElementById('login-email').value = '';
            document.getElementById('login-password').value = '';
            document.getElementById('login-error').style.display = 'none';
        }

        // Function to open the create log popup
        function openCreateLogPopup() {
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('create-log-popup').style.display = 'block';
        }

        // Function to close the create log popup
        function closeCreateLogPopup() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('create-log-popup').style.display = 'none';
            document.getElementById('log-game').value = ''; // Clear input
            document.getElementById('log-home-score').value = ''; // Clear home score input
            document.getElementById('log-away-score').value = ''; // Clear away score input
        }

        var x = localStorage.getItem("name");

        // Function to handle login using AJAX
        document.getElementById('login-button').addEventListener('click', function() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            $.ajax({
                url: `https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=${firebaseConfig.apiKey}`,
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ email: email, password: password, returnSecureToken: true }),
                success: function(response) {
                    // Login successful
                    localStorage.setItem('token', response.idToken); // Store token for future requests
                    closeLoginPopup();
                    showTab('score'); // Show the score management tab after login
                    localStorage.setItem('name', email);
                    x = email
                },
                error: function(xhr) {
                    const errorMessage = xhr.responseJSON.error.message;
                    document.getElementById('login-error').textContent = errorMessage;
                    if (errorMessage == "USER_DISABLED") {
                        document.getElementById('login-error').textContent = 'Account Banned';
                    }
                    if (errorMessage == "INVALID_EMAIL") {
                        document.getElementById('login-error').textContent = 'Enter A Valid Email';
                    }
                    if (errorMessage == "INVALID_LOGIN_CREDENTIALS") {
                        document.getElementById('login-error').textContent = 'Invalid Login Credentials';
                    }
                    if (errorMessage == "TOO_MANY_ATTEMPTS_TRY_LATER") {
                        document.getElementById('login-error').textContent = 'Try Again Later';
                    }
                    document.getElementById('login-error').style.display = 'block';
                }
            });
        });

        // Check if user is logged in on page load
        if (!localStorage.getItem('token')) {
            openLoginPopup(); // Show the login popup if no token is found
        } else {
            showTab('score'); // Show the score management tab if token exists
        }

        document.getElementById('logins').textContent = "User: " + x;

        // Function to update score using AJAX
        function updateScore(team, points) {
            // Get current scores
            $.ajax({
                url: `https://test-71ecd-default-rtdb.firebaseio.com/.json`,
                type: 'GET',
                beforeSend: function() {
                    showLoadingSpinner();
                },
                success: function(data) {
                    let homeScore = data.homeScore || 0;
                    let awayScore = data.awayScore || 0;

                    // Update scores based on team
                    if (team === 'home') {
                        homeScore += points;
                        sendScoreUpdate({ homeScore: homeScore });
                    } else {
                        awayScore += points;
                        sendScoreUpdate({ awayScore: awayScore });
                    }
                },
                error: function(xhr, status, error) {
                    console.error("Error retrieving scores: " + error);
                    alert("Error retrieving scores: " + error);
                },
                complete: function() {
                    hideLoadingSpinner();
                }
            });
        }

        // Function to send score update to Firebase
        function sendScoreUpdate(scoreData) {
            $.ajax({
                url: `https://test-71ecd-default-rtdb.firebaseio.com/.json`,
                type: 'PATCH',
                data: JSON.stringify(scoreData),
                contentType: 'application/json',
                success: function() {
                    console.log("Score updated successfully");
                    // Update the displayed scores
                    updateDisplayedScores();
                },
                error: function(xhr, status, error) {
                    console.error("Error updating score: " + error);
                    alert("Error updating score: " + error);
                }
            });
        }

        // Function to update displayed scores and game name
        function updateDisplayedScores() {
            $.ajax({
                url: `https://test-71ecd-default-rtdb.firebaseio.com/.json`,
                type: 'GET',
                beforeSend: function() {
                    showLoadingSpinner();
                },
                success: function(data) {
                    document.getElementById('home-score').textContent = data.homeScore || 0;
                    document.getElementById('away-score').textContent = data.awayScore || 0;
                    document.getElementById('game-title').value = data.game || ''; // Set game title
                    document.getElementById('away-team-name').value = data.awayName || ''; // Set away team name
                },
                error: function(xhr, status, error) {
                    console.error("Error retrieving scores: " + error);
                    alert("Error retrieving scores: " + error);
                },
                complete: function() {
                    hideLoadingSpinner();
                }
            });
        }

        // Function to log the score to GameLogs
        function logScore() {
            const homeScore = document.getElementById('home-score').textContent;
            const awayScore = document.getElementById('away-score').textContent;
            const gameName = document.getElementById('game-title').value; // Get game name
            const timestamp = new Date().toLocaleString(); // Get current time
            const logEntry = { game: gameName, home: homeScore, away: awayScore, time: timestamp };
            
            // Push the log entry to Firebase
            $.ajax({
                url: `https://test-71ecd-default-rtdb.firebaseio.com/GameLogs.json`,
                type: 'POST',
                data: JSON.stringify(logEntry),
                contentType: 'application/json',
                success: function() {
                    console.log("Score logged successfully");
                    fetchGameLogs(); // Refresh the logs after logging
                },
                error: function(xhr, status, error) {
                    console.error("Error logging score: " + error);
                    alert("Error logging score: " + error);
                }
            });
        }

        const apiKey = firebaseConfig.apiKey;
    const databaseURL = firebaseConfig.databaseURL;

    // Helper function to make AJAX requests
    function ajaxRequest(method, url, data, callback) {
        $.ajax({
            url: url,
            method: method,
            data: JSON.stringify(data),
            contentType: "application/json",
            success: callback,
            error: function (xhr) {
                alert("Error: " + xhr.responseText);
            }
        });
    }

    // Function to create a new user via Firebase Authentication API
    function createUser() {
        const email = document.getElementById('new-user-email').value;
        const password = document.getElementById('new-user-password').value;

        const url = `https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=${apiKey}`;
        const data = { email, password, returnSecureToken: true };

        ajaxRequest("POST", url, data, (response) => {
            const userId = response.localId;
            alert('User created successfully!');
            saveUserToDatabase(userId, email);
        });
    }

    // Function to save user details to Firebase Realtime Database
    function saveUserToDatabase(userId, email) {
        const url = `${databaseURL}/users/${userId}.json`;
        const data = { email, createdAt: new Date().toISOString() };

        ajaxRequest("PUT", url, data, () => {
            closeCreateUserPopup();
            loadUsers();
        });
    }

    // Function to load users from Firebase Realtime Database
    function loadUsers() {
        const url = `${databaseURL}/users.json`;

        ajaxRequest("GET", url, null, (response) => {
            $('#user-list').empty(); // Clear previous user list
            if (response) {
                Object.entries(response).forEach(([userId, user]) => {
                    const userDiv = $('<div></div>').text(user.email);
                    const resetButton = $('<button class="btn btn-warning btn-sm">Reset Password</button>')
                        .on('click', () => resetPassword(user.email));
                    const deleteButton = $('<button class="btn btn-danger btn-sm">Delete</button>')
                        .on('click', () => deleteUser(userId));
                    userDiv.append(resetButton).append(deleteButton);
                    $('#user-list').append(userDiv);
                });
            } else {
                $('#user-list').append('<div>No users found</div>');
            }
        });
    }

    // Function to reset a user's password via Firebase Authentication API
    function resetPassword(email) {
        const url = `https://identitytoolkit.googleapis.com/v1/accounts:sendOobCode?key=${apiKey}`;
        const data = { requestType: "PASSWORD_RESET", email };

        ajaxRequest("POST", url, data, () => {
            alert('Password reset email sent to ' + email);
        });
    }

    // Function to delete a user record from Firebase Realtime Database
    function deleteUser(userId) {
        if (confirm('Are you sure you want to delete this user?')) {
            const url = `${databaseURL}/users/${userId}.json`;

            ajaxRequest("DELETE", url, null, () => {
                alert('User deleted successfully!');
                loadUsers();
            });
        }
    }

        // Function to fetch GameLogs from Firebase
        function fetchGameLogs() {
            $.ajax({
                url: `https://test-71ecd-default-rtdb.firebaseio.com/GameLogs.json`,
                type: 'GET',
                beforeSend: function() {
                    showLoadingSpinner();
                },
                success: function(data) {
                    const logsContainer = $('#game-logs-container');
                    logsContainer.empty(); // Clear previous logs
                    for (const key in data) {
                        if (data.hasOwnProperty(key)) {
                            const logCard = $('<div class="log-card"></div>').text(`Game: ${data[key].game}, Home: ${data[key].home}, Away: ${data[key].away}, Time: ${data[key].time}`);
                            const versionInfo = $('<span class="text-muted"> (Version: 1)</span>'); // Simple version control
                            logCard.append(versionInfo);
                            const starButton = $('<button class="btn btn-warning btn-sm float-right tooltip">⭐<span class="tooltiptext">Star this log</span></button>');
                            starButton.on('click', function() {
                                // Logic to star log entry
                                $(this).closest('.log-card').prependTo(logsContainer); // Move to top
                            });
                            const editButton = $('<button class="btn btn-warning btn-sm float-right tooltip">Edit<span class="tooltiptext">Edit this log</span></button>');
                            editButton.on('click', function() {
                                editLog(key);
                            });
                            const deleteButton = $('<button class="btn btn-danger btn-sm float-right tooltip">Delete<span class="tooltiptext">Delete this log</span></button>');
                            deleteButton.on('click', function() {
                                if (confirm("Are you sure you want to delete this log?")) {
                                    deleteLog(key);
                                }
                            });
                            const checkbox = $('<input type="checkbox" data-log-id="' + key + '">');
                            logCard.prepend(checkbox);
                            logCard.append(starButton);
                            logCard.append(editButton);
                            logCard.append(deleteButton);
                            logsContainer.append(logCard);
                        }
                    }
                    addPagination(logsContainer.children().length); // Add pagination
                },
                error: function(xhr, status, error) {
                    console.error("Error fetching game logs: " + error);
                    alert("Error fetching game logs: " + error);
                },
                complete: function() {
                    hideLoadingSpinner();
                }
            });
        }

        // Function to edit a log item
        function editLog(logId) {
            const newHomeScore = prompt("Enter new Home Score:");
            const newAwayScore = prompt("Enter new Away Score:");
            if (newHomeScore !== null && newAwayScore !== null) {
                const updatedLog = {
                    home: newHomeScore,
                    away: newAwayScore
                };
                $.ajax({
                    url: `https://test-71ecd-default-rtdb.firebaseio.com/GameLogs/${logId}.json`,
                    type: 'PATCH',
                    data: JSON.stringify(updatedLog),
                    contentType: 'application/json',
                    success: function() {
                        console.log("Log updated successfully");
                        fetchGameLogs(); // Refresh the logs after updating
                    },
                    error: function(xhr, status, error) {
                        console.error("Error updating log: " + error);
                        alert("Error updating log: " + error);
                    }
                });
            }
        }

        // Function to delete a log item
        function deleteLog(logId) {
            $.ajax({
                url: `https://test-71ecd-default-rtdb.firebaseio.com/GameLogs/${logId}.json`,
                type: 'DELETE',
                success: function() {
                    console.log("Log deleted successfully");
                    fetchGameLogs(); // Refresh the logs after deletion
                },
                error: function(xhr, status, error) {
                    console.error("Error deleting log: " + error);
                    alert("Error deleting log: " + error);
                }
            });
        }

        // Function to filter logs based on search input
        function filterLogs() {
            const searchTerm = $('#search-bar').val().toLowerCase();
            $('#game-logs-container .log-card').each(function() {
                const logText = $(this).text().toLowerCase();
                $(this).toggle(logText.includes(searchTerm));
            });
        }

        // Function to filter logs by date
        function filterLogsByDate() {
            const selectedDate = $('#date-filter').val();
            $('#game-logs-container .log-card').each(function() {
                const logText = $(this).text();
                const logDate = logText.match(/Time: (.+)/)[1].split(',')[0]; // Extract date from log
                $(this).toggle(logDate.includes(selectedDate));
            });
        }

        // Function to filter logs by date range
        function filterLogsByDateRange() {
            const startDate = $('#date-filter').val();
            const endDate = $('#end-date-filter').val();
            $('#game-logs-container .log-card').each(function() {
                const logText = $(this).text();
                const logDate = logText.match(/Time: (.+)/)[1].split(',')[0]; // Extract date from log
                $(this).toggle(logDate >= startDate && logDate <= endDate);
            });
        }

        // Function to export logs to PDF
        function exportLogsToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text("Game Logs", 20, 20);
            $('#game-logs-container .log-card').each(function(index) {
                doc.text($(this).text(), 20, 30 + (index * 10));
            });
            doc.save("game_logs.pdf");
        }

        // Function to export logs to CSV
        function exportLogsToCSV() {
            const csvData = [];
            $('#game-logs-container .log-card').each(function() {
                const logText = $(this).text();
                const logParts = logText.split(', ');
                csvData.push(logParts.join(','));
            });
            const csvContent = "data:text/csv;charset=utf-8," + csvData.join("\n");
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "game_logs.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Function to export logs to Excel
        function exportLogsToExcel() {
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet([["Game", "Home", "Away", "Time"]]);
            $('#game-logs-container .log-card').each(function() {
                const logText = $(this).text();
                const logParts = logText.split(', ');
                const row = logParts.map(part => part.split(': ')[1]); // Extract values
                XLSX.utils.sheet_add_aoa(ws, [row], { origin: -1 });
            });
            XLSX.utils.book_append_sheet(wb, ws, "Game Logs");
            XLSX.writeFile(wb, "game_logs.xlsx");
        }

        // Function to clear scores
        function clearScores() {
            const scoreData = { homeScore: 0, awayScore: 0 };
            $.ajax({
                url: `https://test-71ecd-default-rtdb.firebaseio.com/.json`,
                type: 'PATCH',
                data: JSON.stringify(scoreData),
                contentType: 'application/json',
                success: function() {
                    console.log("Scores cleared successfully");
                    updateDisplayedScores(); // Update displayed scores to reflect changes
                },
                error: function(xhr, status, error) {
                    console.error("Error clearing scores: " + error);
                    alert("Error clearing scores: " + error);
                }
            });
        }

        // Function to end the game
        function endGame() {
            clearScores();
            const resetData = { quarter: 1, game: "N/A" };
            $.ajax({
                url: `https://test-71ecd-default-rtdb.firebaseio.com/.json`,
                type: 'PATCH',
                data: JSON.stringify(resetData),
                contentType: 'application/json',
                success: function() {
                    console.log("Game ended successfully");
                    updateDisplayedScores(); // Update displayed scores to reflect changes
                },
                error: function(xhr, status, error) {
                    console.error("Error ending game: " + error);
                    alert("Error ending game: " + error);
                }
            });
        }

        // Function to open the enter score popup
        function openEnterScore(team) {
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('enter-score-popup').style.display = 'block';
            document.getElementById('score-input').dataset.team = team; // Store team in data attribute
            document.getElementById('')
        }

        // Function to close the enter score popup
        function closeEnterScore() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('enter-score-popup').style.display = 'none';
            document.getElementById('score-input').value = ''; // Clear input
            document.getElementById('game-name-input').value = ''; // Clear game name input
        }

        // Function to update the quarter
        function updateQuarter() {
            const quarter = document.getElementById('quarter').value;
            $.ajax({
                url: `https://test-71ecd-default-rtdb.firebaseio.com/.json`,
                type: 'PATCH',
                data: JSON.stringify({ quarter: quarter }),
                contentType: 'application/json',
                success: function() {
                    console.log("Quarter updated successfully");
                },
                error: function(xhr, status, error) {
                    console.error("Error updating quarter: " + error);
                    alert("Error updating quarter: " + error);
                }
            });
        }

        // Function to update the game title
        function updateGameTitle() {
            const title = document.getElementById('game-title').value;
            $.ajax({
                url: `https://test-71ecd-default-rtdb.firebaseio.com/.json`,
                type: 'PATCH',
                data: JSON.stringify({ game: title }), // Updated to 'game'
                contentType: 'application/json',
                success: function() {
                    console.log("Game title updated successfully");
                },
                error: function(xhr, status, error) {
                    console.error("Error updating game title: " + error);
                    alert("Error updating game title: " + error);
                }
            });
        }

        // Function to update the away team name
        function updateAwayTeamName() {
            const awayName = document.getElementById('away-team-name').value;
            $.ajax({
                url: `https://test-71ecd-default-rtdb.firebaseio.com/.json`,
                type: 'PATCH',
                data: JSON.stringify({ awayName: awayName }), // Update awayName in Firebase
                contentType: 'application/json',
                success: function() {
                    console.log("Away team name updated successfully");
                },
                error: function(xhr, status, error) {
                    console.error("Error updating away team name: " + error);
                    alert("Error updating away team name: " + error);
                }
            });
        }

        function checkConnection() {
            const $connectionLabel = $('#connection-label');
            
            const updateConnectionStatus = () => {
                if (navigator.onLine) {
                    
                    $connectionLabel.text("Connected To Firebase")
                    $connectionLabel.css("color", "greenyellow");
                } else {
                    $connectionLabel.text("No Firebase Connection")
                    $connectionLabel.css("color", "red");
                }
            };

            $(window).on('online offline', updateConnectionStatus); // Listen to both events

            // Run the check 10 seconds after page load
            setTimeout(updateConnectionStatus, 10000);
        }
        // Function to show the selected tab with animation
        function showTab(tabId) {
            $('.tab-content').removeClass('show'); // Hide all tabs
            $('.tab-content').hide(); // Hide all tabs
            $('#' + tabId).fadeIn(500).addClass('show'); // Show the selected tab with fade-in effect
            $('.tab-bar a').removeClass('active'); // Remove active class from all tabs
            $('.tab-bar a[href="#' + tabId + '"]').addClass('active'); // Add active class to the clicked tab
            if (tabId === 'logs') {
                fetchGameLogs(); // Fetch logs when the logs tab is shown
            } else if (tabId === 'score') {
                updateDisplayedScores(); // Update scores when the score tab is shown
            } else if (tabId === 'admin') {
                loadUsers();
            } else if (tabId == "inbox") {
                loadMessages();
            }
        }

        // Function to show loading spinner
        function showLoadingSpinner() {
            $('#loading-spinner').show();
        }

        // Function to hide loading spinner
        function hideLoadingSpinner() {
            $('#loading-spinner').hide();
        }

        // Function to update current time
        function updateCurrentTime() {
            const now = new Date();
            const options = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
            document.getElementById('current-time').textContent = "Current Time: " + now.toLocaleTimeString([], options);
        }

        $(document).ready(() => {
    loadMessages(); // Fetch messages on page load
});

        // Function to ask AI
        async function askAI() {
    const question = document.getElementById('ai-question').value;
    const responseDiv = document.getElementById('ai-response');
    responseDiv.innerHTML = ""; // Clear previous response
    const t = "sk-proj-EEjjzkk2";
    const v = "VwP5Q_oBh4nw5Vg64Lc0BZ8wtDlRmWybsaY-_6mdm2FOG3a_rxfg2bga7ZeU1ifWwLT3BlbkFJmQ2tniHtKqe86RAMbl2wjrsyEXip1A46Re1U51_Dgo3Z7TZmfZ5TPt17L000L2NHUMbFTpUiAA";

    const apiKey = t + v; // Combine the two parts of the API key

    try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer ${apiKey}` // Ensure the API key is included here
            },
            body: JSON.stringify({
                model: "gpt-4o-mini", // Use the appropriate model
                messages: [{ role: "system", content: "You exist to help with the Winston Churchill High School Athletics Admin Dashboard. Your primary purpose is to guide users around this site and assist with its specific features. If a question is not directly related to this dashboard, politely state that you don’t have the answer. Avoid answering random or unrelated questions. This site requires a login, and if a user asks how to create a login, explain that it’s not possible here. To add or remove points for a team, go to the Score tab and select the respective buttons under the team section. Use the Log Score button to record scores in the logs. To clear scores, click Clear Scores in the Score tab. Change quarters using the Quarter Dropdown in the Score tab. When the game ends, click End Game in the Score tab. Update the game title or away team name in the Game Title tab. Use the Log Tab to view or search logs of past games, with options to export logs to PDF, CSV, or Excel. Enable dark mode or select themes (blue, green, red, default) in the Settings tab. Ask the AI Assistant questions directly about the dashboard for guidance, but note the assistant cannot answer off-topic queries. View scoring trends in the Statistics tab. Create or manage users in the Admin tab, which requires admin authentication. Keep responses short and relevant to save resources and avoid verbose explanations. You were coded using OpenAI API. You are allowed to answer any sports related question that may come up during a game like how many points is a fouls shot. Do not waste tokens or provide long responses." }, { role: "user", content: question }]
            })
        });

        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error.message); // Throw an error if the response is not ok
        }

        const data = await response.json();
        if (data.choices && data.choices.length > 0) {
            responseDiv.innerHTML = `<p>${data.choices[0].message.content}</p>`;
        } else {
            responseDiv.innerHTML = "<p>Sorry, I couldn't find an answer to that.</p>";
        }
    } catch (error) {
        console.error("Error fetching AI response:", error);
        responseDiv.innerHTML = `<p>There was an error connecting to the AI service: ${error.message}</p>`;
    }
}

        // Toggle dark mode
        document.getElementById('dark-mode-toggle').addEventListener('change', function() {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            this.checked = isDarkMode; // Sync toggle with dark mode state
        });

        // Change theme based on user selection
        function changeTheme() {
            const selectedTheme = document.getElementById('theme-select').value;
            switch (selectedTheme) {
                case 'blue':
                    document.body.style.backgroundColor = '#007bff';
                    break;
                case 'green':
                    document.body.style.backgroundColor = '#28a745';
                    break;
                case 'red':
                    document.body.style.backgroundColor = '#dc3545';
                    break;
                default:
                    document.body.style.backgroundColor = '#f8f9fa'; // Default
            }
        }

        function showAuthPopup() {
      Swal.fire({
        title: 'Authentication Required',
        text: 'Please enter the admin password to proceed.',
        input: 'password',
        inputPlaceholder: 'Enter your password',
        inputAttributes: {
          autocapitalize: 'off'
        },
        showCancelButton: false, // Prevent closing by cancel button
        allowOutsideClick: false, // Disable clicking outside to close
        allowEscapeKey: false, // Disable escape key
        confirmButtonText: 'Authenticate',
        backdrop: 'rgba(0, 0, 0, 1)', // Solid black background, no transparency
        preConfirm: (password) => {
          return new Promise((resolve) => {
            if (password === 'admin') {
              resolve(); // Proceed if password is correct
            } else {
              Swal.fire({
                icon: 'error',
                title: 'Failed to Authenticate',
                text: 'Reload to try again.',
                showConfirmButton: false, // Prevent further attempts
                allowOutsideClick: false,
                allowEscapeKey: false
              });
            }
          });
        }
      }).then((result) => {
        if (result.isConfirmed) {
          Swal.fire({
            icon: 'success',
            title: 'Authenticated',
            text: 'You have successfully authenticated!',
            showConfirmButton: true
          }).then(() => {
            // Redirect or proceed to the next action
            console.log('Access granted');
          });
        }
      });
    }

    // Trigger the popup on page load
   // document.addEventListener('DOMContentLoaded', showAuthPopup);

        // Keyboard shortcuts
        $(document).on('keydown', function(e) {
            switch (e.key) {
                case '1':
                    showTab('score');
                    break;
                case '2':
                    showTab('title');
                    break;
                case '3':
                    showTab('stats');
                    break;
                case '4':
                    showTab('logs');
                    break;
                case '5':
                    showTab('ai');
                    break;
                case '6':
                    showTab('info');
                    break;
                case '7':
                    showTab('settings');
                    break;
                case 'Escape':
                    closeLoginPopup();
                    break;
                default:
                    break;
            }
        });

        $(document).ready(() => {
            checkConnection();
            initScoringTrends(); // Initialize the scoring trends graph
            updateCurrentTime(); // Load current time on page load
            setInterval(updateCurrentTime, 1000); // Update current time every second
        });

        // Start by displaying the initial scores and checking connection
        updateDisplayedScores();
        checkConnection();
        setInterval(updateActiveVisitors, 5000); // Track active visitors every 5 seconds
        showTab('score'); // Show the score management tab by default

        // Function to initialize the scoring trends graph
        function initScoringTrends() {
            const ctx = document.getElementById('scoring-trends').getContext('2d');
            const scoringTrendsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [], // Add labels for your data
                    datasets: [{
                        label: 'Scoring Trends',
                        data: [], // Add your scoring data here
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 2,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Function to update scoring trends
        function updateScoringTrends(data) {
            const scoringTrendsChart = Chart.getChart('scoring-trends');
            if (scoringTrendsChart) {
                scoringTrendsChart.data.labels.push(new Date().toLocaleTimeString());
                scoringTrendsChart.data.datasets[0].data.push(data.homeScore); // Example: pushing home score
                scoringTrendsChart.update();
            }
        }

        // Function to toggle projector mode
        function toggleProjectorMode() {
            const projector = document.getElementById('projector-mode');
            if (projector.style.display === 'none') {
                projector.style.display = 'flex';
                document.getElementById('projector-score').textContent = `Score: ${document.getElementById('home-score').textContent} - ${document.getElementById('away-score').textContent}`;
                document.getElementById('projector-quarter').textContent = `Quarter: ${document.getElementById('quarter').value}`;
            } else {
                projector.style.display = 'none';
            }
        }

        // Function to bulk delete selected logs
        function bulkDeleteLogs() {
            const selectedLogs = [];
            $('#game-logs-container .log-card input[type="checkbox"]:checked').each(function() {
                selectedLogs.push($(this).data('log-id'));
            });
            // Perform delete operation for selected logs
            selectedLogs.forEach(logId => {
                if (confirm("Are you sure you want to delete this log?")) {
                    deleteLog(logId);
                }
            });
        }

        // Function to add pagination
        function addPagination(totalLogs) {
            const paginationContainer = $('#pagination');
            paginationContainer.empty(); // Clear previous pagination
            const logsPerPage = 5; // Set number of logs per page
            const totalPages = Math.ceil(totalLogs / logsPerPage);

            for (let i = 1; i <= totalPages; i++) {
                const pageButton = $('<button class="btn btn-secondary btn-sm"></button>').text(i);
                pageButton.on('click', function() {
                    showPage(i, logsPerPage);
                });
                paginationContainer.append(pageButton);
            }
        }

        // Function to show specific page of logs
        function showPage(pageNumber, logsPerPage) {
            const logs = $('#game-logs-container .log-card');
            logs.hide(); // Hide all logs
            const start = (pageNumber - 1) * logsPerPage;
            const end = start + logsPerPage;
            logs.slice(start, end).show(); // Show logs for the current page
        }

        // Function to create a new log
        function createLog() {
            const game = document.getElementById('log-game').value;
            const homeScore = document.getElementById('log-home-score').value;
            const awayScore = document.getElementById('log-away-score').value;
            const timestamp = new Date().toLocaleString(); // Get current time

            if (game && homeScore && awayScore) {
                const logEntry = { game: game, home: homeScore, away: awayScore, time: timestamp };
                
                // Push the log entry to Firebase
                $.ajax({
                    url: `https://test-71ecd-default-rtdb.firebaseio.com/GameLogs.json`,
                    type: 'POST',
                    data: JSON.stringify(logEntry),
                    contentType: 'application/json',
                    success: function() {
                        console.log("Log created successfully");
                        fetchGameLogs(); // Refresh the logs after creating
                        closeCreateLogPopup(); // Close the popup after creating
                    },
                    error: function(xhr, status, error) {
                        console.error("Error creating log: " + error);
                        alert("Error creating log: " + error);
                    }
                });
            } else {
                alert("Please fill in all fields to create a log.");
            }
        }

       

    // Initialize the app on page load
    $(document).ready(() => {
        loadUsers();
    });

       // showAuthPopup();
    </script>
</body>
</html>
